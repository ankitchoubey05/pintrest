<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/profile.css">
    <link rel="shortcut icon" href="/images/pinterest-logo-png-1984.png" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    
</head>
<style>
  
  @import url(https://fonts.googleapis.com/css?family=Oswald:400);

  .navigation {
    width: 100%;
    background-color: black;
  }
  
  .navigation .imaan {
    width: 25px;
    border-radius: 50px;
    float: left;
  }
  
  .navigation .logout {
    font-size: .8em;
    font-family: 'Oswald', sans-serif;
    position: relative;
    right: -18px;
    bottom: -4px;
    overflow: hidden;
    letter-spacing: 3px;
    opacity: 0;
    transition: opacity .45s;
    -webkit-transition: opacity .35s;
    
  }
  
  .navigation .button1 {
    text-decoration: none;
    float: right;
    padding: 12px;
    margin: 15px;
    color: white;
    width: 25px;
    background-color: black;
    transition: width .35s;
    -webkit-transition: width .35s;
    overflow: hidden;
  }
  
  .navigation  a:hover{
    width: 100px;
  }
  
  .navigation  a:hover .logout{
    opacity: .9;
  }
  
  .navigation a {
    text-decoration: none;
  }
 
</style>


<body>
      <div hidden class="sqr">
          <div class="boxsqr">
            <div class="sidesearch">
    
            </div>
          </div>
      </div>
        <div class="menu">
          <img draggable="false" class="logo" src="https://cdn1.iconfinder.com/data/icons/logotypes/32/pinterest-512.png">
          <a class="home" href="/profile" >Home</a>
          <div id="post"><a href="/post">create post</a></div>
         
          <input id="one" type="text" class="search-bar" placeholder="Search">
      
          <button id="two" class="search-bar"></button>
          <div class="icon-container">
            <img tabindex="1" draggable="false"  class="icon bell" src="https://i.hizliresim.com/rcvolcu.png">
            <img tabindex="1" draggable="false" class="icon message" src="https://i.hizliresim.com/newumah.png">
            
            <img tabindex="1" draggable="false" class="icon pp" src="/images/dpside/<%=user.imagedp%>">
            <img tabindex="1" draggable="false" class="icon btn" src="https://i.hizliresim.com/g15mqud.png">
            
            <!----FOCUS----->
            <div tabindex="1" class="focus-bar bell-bar">nothing</div>
            <!-------------------->
            <div tabindex="1" class="focus-bar message-bar">you are alone</div>
            <!-------------------->
            <div tabindex="1" class="focus-bar pp-bar"><img  src="/images/dpside/<%=user.imagedp%>"><a href="/feed" >devrimos</a>
            <h1></h1>
            </div>
            <!-------------------->
            <div tabindex="1" id="btn" class="focus-bar btn-bar">
              <div class="box">
                <div class="top">
                  <a href="/feed">
                    
                    <div class="images ">
                      <img src="/images/dpside/<%=user.imagedp%>" alt="">
                    </div>
                  </a>
               <div class="xox">

                 <a href="/feed"><%=user.username%></a>
                 <p>personal</p>
                 <a href="/feed"><%=user.email%></a>
               </div>
                </div>
                
            <div class="navigation">
  
	            <a class="button1" href="/logout">
  	            <img src="/images/dpside/<%=user.imagedp%>">
  
               <div class="logout">LOGOUT</div>

	                </a>
  
                            </div>
              </div>
            </div>
            
          </div>
        </div>
        
        <!--------------------------->
        <div class="responsive-search-bar">
            <input type="text">
            <p class="close">‚ùå</p>
          </div>
        <!--------------------------->
       

        <div class="boxv">
            <div class="postbox">
                <div class="imagev">
                    <img src="/images/uploads/<%=post.image%>" alt="">
                </div>
                <div class="commentv">
                    <div class="topv">
                        <div class="topimgv">
                            <img src="/images/dpside/<%=post.user.imagedp%>" alt="">
                            <div class="namev">
                             <h4><%=post.user.username%></h1>
                             <p class="followersv" ><%=post.user.followers.length%>follower</p>
                            </div>
                        </div>
                       

                          <!-- <button data-id="<%=post.user._id%>" id="follow">follow</button> -->
                          <button id="follow" data-id="<%=post.user._id%>" <% if(user.followings.includes(post.user._id)) { %> style="display:none" <% } %>>Follow</button>
                          <button id="unfollow" data-id="<%=post.user._id%>" <% if(!user.followings.includes(post.user._id)) { %> style="display:none" <% } %>>Following</button>

                        
                        
                    </div>
                    <div class="midv">
                      <h1>comments</h1>
                      <div class="commentsv">
                        <% post.comments.forEach(function(comment) { %>
                          <div class="usercomment">
                            <img src="/images/dpside/<%=user.imagedp%>" alt="">
                            <h1><%= user.username %></h1>
                            <a href=""><%= comment.comment %></a>
                          </div>
                        <% }); %>
                      </div>
                    </div>
                    <div class="writecommentv">
                   <!-- Assuming this is inside the post view -->
                   <div class="toplike">
                    <button id="likeBtn" data-post-id="<%= post._id %>"><i class="ri-heart-3-fill"></i></button>
                    <span id="likesCount"><%= post.likes.length %></span> 
                  </div>
                  

                      
                      <div class="bottomcomment">
                        <img src="/images/dpside/<%=user.imagedp%>" alt="">
                        <input id="commentInput" type="text" placeholder="Add a comment">
                        <p id="submitComment" ><i class="ri-send-plane-fill"></i></p>
                      </div>
                    </div>
                </div>
            </div>
        </div>
      </body>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js" integrity="sha512-NQfB/bDaB8kaSXF8E77JjhHG5PM6XVRxvHzkZiwl3ddWCEPBa23T76MuWSwAJdMGJnmQqM0VeY9kFszsrBEFrQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
      let inp=document.querySelector("#one");
      let clutter="";
      inp.addEventListener("input",function(){
        axios.get(`/username/${inp.value}`)
        .then(function(data){
          clutter=""
          console.log(data)
          data.data.forEach(function(data){
            clutter +=`
            <a href="/postprofile/${data._id}">
       
        <i class="ri-user-search-line"></i>
        <h1>${data.username}</h1>
          </a>
            ` 
              //  console.log(elem.id)
          })
          document.querySelector(".boxsqr").innerHTML=clutter;
        })
    
        
      })
// dynamic me value input ki chaiye h na ki current user ki 


    document.getElementById("two").onclick=function(){
    document.getElementById("two").style.pointerEvents="none";
    document.getElementById("two").style.opacity="0.5";
    document.querySelector(".responsive-search-bar").style.top="0px";
  }
  document.querySelector(".close").onclick=function(){
    document.getElementById("two").style.pointerEvents="auto";
    document.getElementById("two").style.opacity="1";
    document.querySelector(".responsive-search-bar").style.top="-300px";
  }

  var flag=0;
  document.querySelector("#one").addEventListener("click",function(){
    if(flag==0){
      
      document.querySelector(".sqr").style.display="none";
      flag=1;
    }
    else{

      document.querySelector(".sqr").style.display="initial";
      flag=0;
    }
  })

  // Submit comment
 // Submit comment when Enter key is pressed
document.getElementById("commentInput").addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    const commentInput = document.getElementById("commentInput").value;
    // Replace postId with the actual post ID
    const postId = "<%= post._id %>"; // You need to provide the post ID here
    axios.post(`/post/${postId}/comment`, { comment: commentInput })
      .then((response) => {
        // Update the comments section with the new comment
        const commentsContainer = document.querySelector(".commentsv");
        const newCommentDiv = document.createElement("div");
        newCommentDiv.classList.add("usercomment");
        newCommentDiv.innerHTML = `
          <img src="/images/dpside/<%= user.imagedp %>" alt="">
          <h1><%= user.username %></h1>
          <a href="">${commentInput}</a>
        `;
        commentsContainer.appendChild(newCommentDiv);
        // Clear the comment input field
        document.getElementById("commentInput").value = "";
      })
      .catch((error) => {
        console.error('Error submitting comment:', error);
      });
  }
});


  let followBtn = document.querySelector("#follow");
let unfollowBtn = document.querySelector("#unfollow");

followBtn.addEventListener("click", (e) => {
  let postId = e.target.dataset.id;
  
  axios.post(`/follow/${postId}`)
    .then(function(response) {
      console.log(response.data); // Log the response text
      // Update button visibility
      followBtn.style.display = "none";
      unfollowBtn.style.display = "block";
      // Update follower count if available in response
    
        e.target.parentNode.querySelector(".followersv").textContent = response.data.followers.length + ' follower';
      
    })
    .catch(function(error) {
      console.error('Error following:', error);
    });
});

unfollowBtn.addEventListener("click", (e) => {
  let postId = e.target.dataset.id;
  
  axios.post(`/unfollow/${postId}`)
    .then(function(response) {
      console.log(response.data); // Log the response text
      // Update button visibility
      followBtn.style.display = "block";
      unfollowBtn.style.display = "none";
    })
    .catch(function(error) {
      console.error('Error unfollowing:', error);
    });
});


// Assuming you have included Axios library in your HTML

// JavaScript for liking or unliking a post
document.addEventListener("DOMContentLoaded", () => {
  const likeBtn = document.getElementById("likeBtn");
  const postId = likeBtn.dataset.postId;
  
  likeBtn.addEventListener("click", () => {
    axios.post(`/post/${postId}/like`)
      .then((response) => {
        const likesCount = response.data.likes;
        const userLiked = response.data.userLiked;
        
        // Update the like button appearance based on whether the user has liked the post
        if (userLiked) {
          likeBtn.classList.remove("liked");
        } else {
          likeBtn.classList.add("liked");
        }
        
        // Update the number of likes displayed
        const likesDisplay = document.getElementById("likesCount");
        likesDisplay.textContent = likesCount;
      })
      .catch((error) => {
        console.error('Error liking/unliking post:', error);
      });
  });
});


</script>
</html>
